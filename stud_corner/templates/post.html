{% from "pagination.html" import render_pagination with context %}
{% extends "layout.html" %}

{% set active_page = "post" %}


{% block content %}
<div class="container col-md-6 mt-3 rounded shadow bg-white border">
    <form method="POST">
        <h1 class="h3 fw-normal my-3">New Post</h1>
        <hr>
        <div class="form-floating mb-3">
            <input type="text" name="subject" class="form-control" id="floatingInput" placeholder="it is subject" autocomplete="off" autofocus>
            <label for="floatingInput">Subject</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" name="title" class="form-control" id="floatingInput" placeholder="it is title" autocomplete="off" autofocus required>
            <label for="floatingInput">Title</label>
        </div>
        <div class="form-floating mb-3">
            <textarea name="content" class="form-control" id="floatingTextarea2"  placeholder="This is my post...">Write Your Post Here...</textarea>
            <label for="floatingTextarea2">Write Post</label>
        </div>
        <div class="d-flex justify-content-center">   
            <button class="w-30 btn btn-sm btn-primary mb-3" type="submit">Submit</button>
        </div>
    </form>
</div>
<br>
{% if current_user_posts %}

    <div class="container col-md-6">
        <div class="row justify-content-center">
            <h3>Previous Posts </h3>
        </div>
    </div>
    {% for post in current_user_posts.items %}
        <div class="container col-md-6 bg-white rounded shadow border mb-3">
            <div class="row justify-content-center">
                <article class="blog-post by-3">
                    <h5 class="blog-post-title">{{ post.title |title  }}</h5>
                    <h6 class="blog-post-title">{{ post.subject |title }}</h6>
                    <p class="blog-post-meta">{{ post.date_posted.strftime("%d %B %Y") }} </p>
                    <hr>
                    {% if post.content |wordcount > 50 %}
                        <p>{{ post.content|e |truncate(400) |safe |urlize }} <a href="{{ url_for('views.read_more', id = post.id) }}" class="text-decoration-none">read more</a></p>
                        {% else %}
                        <p>{{ post.content |replace("\n", "</br>")|safe |urlize}}</p>
                    {% endif %}
                </article>
                <!-- Button trigger modal -->
                <div class="d-flex justify-content-end">   
                    <span><button type="button" class="w-30 btn btn-sm btn-success mx-3 mb-3"><a href="{{ url_for('views.update_post', id = post.id) }}" class="text-decoration-none link-light">Update</a></button></span>
                    <span><button type="button" class="w-30 btn btn-sm btn-danger mb-3" data-bs-toggle="modal" data-bs-target="#deleteModal{{ post.id }}">
                        Delete</button></span>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="deleteModal{{ post.id }}" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteModalLabel">Deleting this post!</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to delete this post?
                              </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-danger"><a href="{{ url_for('views.delete_post', id = post.id) }}" class="text-decoration-none link-light">Delete</a></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    {% endfor %}
{% endif %}

{{render_pagination(current_user_posts, "views.post", name = "pagination for post page" )}}

{% endblock %}


